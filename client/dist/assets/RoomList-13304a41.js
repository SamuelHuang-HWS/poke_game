import{h as v,m as j,o as f,c as _,i as e,j as S,v as p,p as J,t as u,q as P,w as B,s as L,r as I,x as U,a as C,u as V,n as F,l as R,F as N,y as K,k,z as q}from"./vendor-7103c11f.js";import{_ as x,u as z}from"./index-714f4fbd.js";import{u as D}from"./room-9fddfd0e.js";import"./utils-3f3b5d51.js";const A={name:"PasswordModal",props:{visible:{type:Boolean,default:!1}},emits:["confirm","cancel"],setup(n,{emit:o}){const a=v(""),s=v(""),r=v(null),m=()=>{if(!a.value||a.value.trim()===""){s.value="å¯†ç ä¸èƒ½ä¸ºç©º";return}o("confirm",a.value.trim())},t=()=>{a.value="",s.value="",o("cancel")};return j(()=>n.visible,i=>{i&&(a.value="",s.value="",L(()=>{r.value&&r.value.focus()}))}),{password:a,error:s,passwordInput:r,handleConfirm:m,handleCancel:t}}},E={class:"modal-container glass-effect"},O={class:"modal-header"},G={class:"modal-body"},H={class:"form-group"},Q={key:0,class:"error-message"},W={class:"modal-footer"},X=["disabled"];function Y(n,o,a,s,r,m){return a.visible?(f(),_("div",{key:0,class:"modal-overlay",onClick:o[5]||(o[5]=B((...t)=>s.handleCancel&&s.handleCancel(...t),["self"]))},[e("div",E,[e("div",O,[o[6]||(o[6]=e("h3",{class:"modal-title"},"è¾“å…¥æˆ¿é—´å¯†ç ",-1)),e("button",{class:"close-button",onClick:o[0]||(o[0]=(...t)=>s.handleCancel&&s.handleCancel(...t))},"Ã—")]),e("div",G,[e("div",H,[o[7]||(o[7]=e("label",{class:"form-label"},"å¯†ç ",-1)),S(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>s.password=t),type:"password",class:"form-input",placeholder:"è¯·è¾“å…¥æˆ¿é—´å¯†ç ",maxlength:"20",onKeyup:o[2]||(o[2]=J((...t)=>s.handleConfirm&&s.handleConfirm(...t),["enter"])),ref:"passwordInput"},null,544),[[p,s.password]]),s.error?(f(),_("div",Q,u(s.error),1)):P("",!0)])]),e("div",W,[e("button",{class:"button button-cancel",onClick:o[3]||(o[3]=(...t)=>s.handleCancel&&s.handleCancel(...t))}," å–æ¶ˆ "),e("button",{class:"button button-confirm",onClick:o[4]||(o[4]=(...t)=>s.handleConfirm&&s.handleConfirm(...t)),disabled:!s.password}," ç¡®è®¤ ",8,X)])])])):P("",!0)}const T=x(A,[["render",Y],["__scopeId","data-v-bcf853e8"]]);const Z={name:"RoomCard",components:{PasswordModal:T},props:{room:{type:Object,required:!0},currentUserId:{type:String,default:null}},emits:["select","join"],setup(n,{emit:o}){const a=v(!1),s=()=>!n.currentUserId||!n.room.players?!1:n.room.players.some(h=>{var l,w;return((l=h.userId)==null?void 0:l.toString())===((w=n.currentUserId)==null?void 0:w.toString())}),r=()=>n.room.isFull?!1:s()?!0:n.room.status==="waiting";return{showPasswordModal:a,handleJoin:()=>{if(r()){if(s()){o("join",n.room.roomId);return}n.room.hasPassword?a.value=!0:o("join",n.room.roomId)}},handlePasswordConfirm:h=>{a.value=!1,o("join",n.room.roomId,h)},canJoinRoom:r,getButtonText:()=>n.room.isFull?"æˆ¿é—´å·²æ»¡":s()?"è¿›å…¥æˆ¿é—´":"åŠ å…¥æˆ¿é—´"}},methods:{getStatusText(n){return{waiting:"ç­‰å¾…ä¸­",playing:"æ¸¸æˆä¸­",finished:"å·²ç»“æŸ"}[n]||n},getMaxPlayers(){return 5}}},$={class:"room-header"},oo={class:"room-title"},so={class:"room-name"},eo={key:0,class:"password-badge",title:"éœ€è¦å¯†ç "},ao={class:"room-details"},to={class:"detail-item"},no={class:"value"},ro={class:"detail-item"},lo={class:"value"},io={class:"detail-item"},co={class:"value"},mo={class:"detail-item"},uo={class:"value"},fo={class:"room-footer"},vo=["disabled"];function _o(n,o,a,s,r,m){const t=I("PasswordModal");return f(),_("div",{class:"room-card glass-effect",onClick:o[2]||(o[2]=i=>n.$emit("select",a.room))},[e("div",$,[e("div",oo,[e("h3",so,"æˆ¿é—´ "+u(a.room.roomId),1),a.room.hasPassword?(f(),_("span",eo," ðŸ”’ ")):P("",!0)]),e("span",{class:U(["room-status",a.room.status])},u(m.getStatusText(a.room.status)),3)]),e("div",ao,[e("div",to,[o[3]||(o[3]=e("span",{class:"label"},"æˆ¿é—´å·:",-1)),e("span",no,u(a.room.roomId),1)]),e("div",ro,[o[4]||(o[4]=e("span",{class:"label"},"å•æ³¨å€æ•°:",-1)),e("span",lo,u(a.room.baseBet)+"å€",1)]),e("div",io,[o[5]||(o[5]=e("span",{class:"label"},"å±€æ•°:",-1)),e("span",co,u(a.room.currentRound)+"/"+u(a.room.totalRounds),1)]),e("div",mo,[o[6]||(o[6]=e("span",{class:"label"},"çŽ©å®¶:",-1)),e("span",uo,u(a.room.playersCount)+"/"+u(m.getMaxPlayers()),1)])]),e("div",fo,[e("button",{onClick:o[0]||(o[0]=B((...i)=>s.handleJoin&&s.handleJoin(...i),["stop"])),class:"join-button",disabled:!s.canJoinRoom()},u(s.getButtonText()),9,vo)]),C(t,{visible:s.showPasswordModal,onConfirm:s.handlePasswordConfirm,onCancel:o[1]||(o[1]=i=>s.showPasswordModal=!1)},null,8,["visible","onConfirm"])])}const ho=x(Z,[["render",_o],["__scopeId","data-v-11b5c4db"]]);const wo={name:"RoomList",components:{RoomCard:ho,PasswordModal:T},setup(){const n=V(),o=D(),a=z(),s=v(""),r=v(!1),m=v(!1),t=v(null),i=v([]);F(async()=>{await h()});const h=async()=>{try{r.value=!0;const c=await o.fetchUserRooms();i.value=c}catch(c){console.error("åŠ è½½æˆ¿é—´åˆ—è¡¨å¤±è´¥:",c),alert(c.message||"åŠ è½½æˆ¿é—´åˆ—è¡¨å¤±è´¥")}finally{r.value=!1}},l=async()=>{var c,g;if(s.value.trim())try{r.value=!0;const d=await o.searchRoom(s.value.trim());d&&((c=d==null?void 0:d.data)!=null&&c.data)&&((g=d.data)!=null&&g.data.roomId)?(t.value=d.data.data,t.value.hasPassword?m.value=!0:await b(t.value.roomId)):alert("æˆ¿é—´ä¸å­˜åœ¨")}catch(d){console.error("æœç´¢æˆ¿é—´å¤±è´¥:",d),alert(d.message||"æˆ¿é—´ä¸å­˜åœ¨")}finally{r.value=!1}},w=async c=>{t.value&&await b(t.value.roomId,c)},b=async(c,g)=>{var d,M;try{r.value=!0;const y=await o.joinRoom(c,g);(M=(d=y==null?void 0:y.data)==null?void 0:d.data)!=null&&M.roomId&&n.push(`/rooms/${y.data.data.roomId}`)}catch(y){console.error("åŠ å…¥æˆ¿é—´å¤±è´¥:",y),alert(y.message||"åŠ å…¥æˆ¿é—´å¤±è´¥")}finally{r.value=!1}};return{searchRoomId:s,isLoading:r,rooms:i,showPasswordModal:m,handleSearch:l,handlePasswordConfirm:w,handleJoinRoom:b,authStore:a}}},yo={class:"room-list-container"},bo={class:"navbar glass-effect"},Co={class:"nav-left"},go={class:"nav-right"},Io={class:"search-section"},Ro={class:"search-container glass-effect"},ko=["disabled"],Po={class:"rooms-section"},xo={key:0,class:"loading"},Mo={key:1,class:"empty-state"},So={key:2,class:"rooms-grid"};function po(n,o,a,s,r,m){const t=I("router-link"),i=I("RoomCard"),h=I("PasswordModal");return f(),_("div",yo,[e("nav",bo,[e("div",Co,[C(t,{to:"/",class:"back-link"},{default:R(()=>[...o[4]||(o[4]=[k("â† è¿”å›žé¦–é¡µ",-1)])]),_:1})]),o[6]||(o[6]=e("div",{class:"nav-center"},[e("h1",{class:"title"},"æˆ¿é—´åˆ—è¡¨")],-1)),e("div",go,[C(t,{to:"/rooms/create",class:"create-link"},{default:R(()=>[...o[5]||(o[5]=[k("åˆ›å»ºæˆ¿é—´",-1)])]),_:1})])]),e("div",Io,[e("div",Ro,[S(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.searchRoomId=l),type:"text",placeholder:"è¾“å…¥æˆ¿é—´å·æœç´¢æˆ¿é—´",class:"search-input",onKeyup:o[1]||(o[1]=J((...l)=>s.handleSearch&&s.handleSearch(...l),["enter"]))},null,544),[[p,s.searchRoomId]]),e("button",{onClick:o[2]||(o[2]=(...l)=>s.handleSearch&&s.handleSearch(...l)),class:"search-button",disabled:!s.searchRoomId.trim()}," æœç´¢ ",8,ko)])]),e("div",Po,[o[11]||(o[11]=e("h2",{class:"section-title"},"æˆ‘çš„æˆ¿é—´",-1)),s.isLoading?(f(),_("div",xo,[...o[7]||(o[7]=[e("div",{class:"spinner"},null,-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):s.rooms.length===0?(f(),_("div",Mo,[o[9]||(o[9]=e("div",{class:"empty-icon"},"ðŸ ",-1)),o[10]||(o[10]=e("p",null,"æš‚æ— æˆ¿é—´",-1)),C(t,{to:"/rooms/create",class:"create-button"},{default:R(()=>[...o[8]||(o[8]=[k("åˆ›å»ºæˆ¿é—´",-1)])]),_:1})])):(f(),_("div",So,[(f(!0),_(N,null,K(s.rooms,l=>{var w,b;return f(),q(i,{key:l.roomId,room:l,"current-user-id":(b=(w=s.authStore)==null?void 0:w.user)==null?void 0:b.id,onJoin:s.handleJoinRoom,class:"room-card"},null,8,["room","current-user-id","onJoin"])}),128))]))]),C(h,{visible:s.showPasswordModal,onConfirm:s.handlePasswordConfirm,onCancel:o[3]||(o[3]=l=>s.showPasswordModal=!1)},null,8,["visible","onConfirm"])])}const Lo=x(wo,[["render",po],["__scopeId","data-v-9f75976e"]]);export{Lo as default};
