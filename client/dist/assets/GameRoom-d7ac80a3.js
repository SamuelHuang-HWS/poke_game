import{o as u,c as y,i as a,t as f,x as V,q as P,r as K,F as j,y as O,z,B as ee,h as T,C as S,n as te,D as ae,j as ue,v as me,w as Z,T as $,E as ye,u as ve,a as fe,G as _e}from"./vendor-7103c11f.js";import{_ as J,u as se,s as c,a as ge}from"./index-714f4fbd.js";import{u as he}from"./room-9fddfd0e.js";import"./utils-3f3b5d51.js";const be={name:"Card",props:{suit:{type:String,default:""},rank:{type:Number,default:0},isFaceUp:{type:Boolean,default:!1}},computed:{isValidCard(){return this.suit!==void 0&&this.rank!==void 0&&this.rank>0},suitSymbol(){return{"â™ ":"â™ ","â™¥":"â™¥","â™£":"â™£","â™¦":"â™¦"}[this.suit]||""},displayRank(){return{3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10",11:"J",12:"Q",13:"K",14:"A",15:"2"}[this.rank]||""}}},Re={key:0,class:"card-front"},Ce={class:"card-rank"},Ie={class:"card-suit"},ke={key:1,class:"card-back"};function Se(l,s,o,t,i,r){return r.isValidCard?(u(),y("div",{key:0,class:V(["card",{"face-up":o.isFaceUp,"face-down":!o.isFaceUp}])},[o.isFaceUp?(u(),y("div",Re,[a("div",Ce,f(r.displayRank),1),a("div",Ie,f(r.suitSymbol),1)])):(u(),y("div",ke))],2)):P("",!0)}const Pe=J(be,[["render",Se],["__scopeId","data-v-a13518eb"]]);const pe={name:"PlayerSeat",components:{Card:Pe},props:{player:{type:Object,required:!0},isSelf:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},showCards:{type:Boolean,default:!1},positionIndex:{type:Number,default:0},totalPlayers:{type:Number,default:2},currentPlayerId:{type:String,default:null}},computed:{validCards(){return!this.player||!this.player.cards?[]:this.player.cards.filter(l=>l&&l.suit&&l.rank)},seatStyle(){if(!this.player)return{};const l=this.totalPlayers||2,s=this.positionIndex||0,o=50,t=50,i=35,r=25;let n;if(l===2)n=s===0?-Math.PI/2:Math.PI/2;else{const b=2*Math.PI/l;n=s*b-Math.PI/2}const h=o+i*Math.cos(n),k=t-r*Math.sin(n);return{left:`${h}%`,top:`${k}%`,transform:"translate(-50%, -50%)"}},shouldShowCardFace(){return!this.player||!this.player.cards?!1:this.isSelf?this.player.hasSeenCards||!1:!!(this.$parent&&this.$parent.game&&this.$parent.game.status==="settled")}},methods:{getStatusText(l){return l==="playing"&&this.currentPlayerId&&this.player.userId&&this.player.userId.toString()===this.currentPlayerId.toString()?"ä¸‹æ³¨ä¸­":l==="playing"?"å¾…ä¸‹æ³¨":{waiting:"ç­‰å¾…",ready:"å‡†å¤‡",folded:"å·²å¼ƒç‰Œ",busted:"å·²å‡ºå±€"}[l]||l}}},Ge={class:"player-info"},we={class:"player-right"},Be={class:"player-name"},xe={key:0,class:"player-cards"};function Ae(l,s,o,t,i,r){const n=K("Card");return o.player?(u(),y("div",{class:"player-seat-container",style:ee(r.seatStyle),key:o.player.userId},[a("div",{class:V(["player-seat",{self:o.isSelf,active:o.isActive}])},[a("div",Ge,[s[0]||(s[0]=a("div",{class:"player-left"},[a("div",{class:"player-avatar"},[a("div",{class:"avatar-placeholder"},"ðŸ‘¤")])],-1)),a("div",we,[a("div",Be,f(o.player.nickname||"æœªçŸ¥çŽ©å®¶"),1),a("div",{class:V(["player-status",o.player.status||"waiting"])},f(r.getStatusText(o.player.status)),3)])])],2),o.player.cards&&o.player.cards.length>0?(u(),y("div",xe,[(u(!0),y(j,null,O(r.validCards,(h,k)=>(u(),z(n,{key:`card-${k}-${h.suit}-${h.rank}`,suit:h.suit||"",rank:h.rank||0,"is-face-up":r.shouldShowCardFace,class:"player-card"},null,8,["suit","rank","is-face-up"]))),128))])):P("",!0)],4)):P("",!0)}const Me=J(pe,[["render",Ae],["__scopeId","data-v-5c14458c"]]);function Te(l){return!l||l.length===0?"æ— ç‰Œ":l.map(s=>{const t={11:"J",12:"Q",13:"K",14:"A",15:"2"}[s.rank]||s.rank;return`${s.suit}${t}`}).join(" ")}function Fe(l){return{1:"å•å¼ ",2:"å¯¹å­",3:"é¡ºå­",4:"åŒèŠ±",5:"åŒèŠ±é¡º",6:"è±¹å­"}[l]||"æœªçŸ¥"}const Le={name:"GameBoard",components:{PlayerSeat:Me},props:{room:{type:Object,default:null},game:{type:Object,default:null}},computed:{displayPlayers(){var l,s,o;try{if(!((l=this.game)!=null&&l.players))return[];const t=this.game.players,r=(o=(s=se().user)==null?void 0:s.id)==null?void 0:o.toString();if(!r)return t.map(b=>({...b,isSelf:!1}));const n=[...t],h=n.findIndex(b=>b.userId.toString()===r);if(h>-1){const b=n.splice(h,1)[0];n.unshift(b)}return n.map((b,G)=>({...b,positionIndex:G,totalPlayers:n.length,isSelf:b.userId.toString()===r}))}catch(t){return console.error("displayPlayersè®¡ç®—å±žæ€§å‡ºé”™:",t),[]}},currentPlayerId(){return!this.game||!this.game.currentPlayerId?null:this.game.currentPlayerId.toString()},bettingPlayers(){return this.validDisplayPlayers?this.validDisplayPlayers.filter(l=>l.totalBet>0):[]},validDisplayPlayers(){try{return this.displayPlayers.filter(o=>o&&o.userId)}catch(l){return console.error("validDisplayPlayersè®¡ç®—å±žæ€§å‡ºé”™:",l),[]}}},methods:{getStatusText(l){return{waiting:"ç­‰å¾…å¼€å§‹",betting:"ä¸‹æ³¨é˜¶æ®µ",comparing:"æ¯”ç‰Œé˜¶æ®µ",settled:"å·²ç»“ç®—"}[l]||l},getCardTypeText:Fe,formatCards:Te,isActivePlayer(l){return!this.game||!this.game.currentPlayerId?!1:this.game.currentPlayerId.toString()===l.userId.toString()},shouldShowCards(l){return this.game?!!l.isSelf:!1}}},Ee={class:"game-board glass-effect"},Ve={class:"board-header"},Ne={class:"room-info"},Ue={class:"room-id"},je={class:"room-round"},Oe={class:"pot-info"},qe={class:"pot-amount"},ze={class:"game-table"},Je={class:"poker-table"},Ke={class:"center-area"},Qe={key:0,class:"game-status"},We={key:1,class:"betting-chips"},Xe={class:"pot-amount"},Ye={class:"chips-display"},He={class:"chip"},Ze={class:"chip-amount"},De={key:2,class:"winner-info"},$e={class:"winner-text"},et={class:"winnings"},tt={class:"players-seats"};function at(l,s,o,t,i,r){var h,k,b,G,w,x,F,L;const n=K("PlayerSeat");return u(),y("div",Ee,[a("div",Ve,[a("div",Ne,[a("span",Ue,"æˆ¿é—´å·: "+f(((h=o.room)==null?void 0:h.roomId)||""),1),a("span",je,"ç¬¬ "+f(((k=o.room)==null?void 0:k.currentRound)||0)+"/"+f(((b=o.room)==null?void 0:b.totalRounds)||0)+" å±€",1)]),a("div",Oe,[s[0]||(s[0]=a("span",{class:"pot-label"},"åº•æ± :",-1)),a("span",qe,"ðŸ’° "+f(((G=o.game)==null?void 0:G.pot)||0),1)])]),a("div",ze,[a("div",Je,[a("div",Ke,[(w=o.game)!=null&&w.status?(u(),y("div",Qe,f(r.getStatusText(o.game.status)),1)):P("",!0),((x=o.game)==null?void 0:x.status)==="betting"?(u(),y("div",We,[a("div",Xe,"å½“å‰åº•æ± : ðŸ’° "+f(((F=o.game)==null?void 0:F.pot)||0),1),a("div",Ye,[(u(!0),y(j,null,O(r.bettingPlayers,(v,_)=>(u(),y("div",{key:`chip-${v.userId}`,class:"player-chip",style:ee({transform:`rotate(${_*30-r.bettingPlayers.length*15}deg)`})},[a("div",He,[a("span",Ze,f(v.totalBet),1)])],4))),128))])])):P("",!0),(L=o.game)!=null&&L.winner?(u(),y("div",De,[a("div",$e,"ðŸ† "+f(o.game.winner.nickname)+" èŽ·èƒœ!",1),a("div",et,"èŽ·å¾—: ðŸ’° "+f(o.game.winner.winnings),1)])):P("",!0)])]),a("div",tt,[(u(!0),y(j,null,O(r.validDisplayPlayers,(v,_)=>(u(),z(n,{key:`player-${v.userId}-${_}`,player:v,"is-self":v.isSelf,"is-active":r.isActivePlayer(v),"show-cards":r.shouldShowCards(v),"position-index":v.positionIndex,"total-players":v.totalPlayers,"current-player-id":r.currentPlayerId,class:"player-seat"},null,8,["player","is-self","is-active","show-cards","position-index","total-players","current-player-id"]))),128))])])])}const st=J(Le,[["render",at],["__scopeId","data-v-496947da"]]);const nt={name:"BetControls",props:{minBet:{type:Number,default:0},playerGold:{type:Number,default:0},activePlayers:{type:Array,default:()=>[]},hasSeenCards:{type:Boolean,default:!1},canSeeCards:{type:Boolean,default:!1},canCall:{type:Boolean,default:!1},canRaise:{type:Boolean,default:!1},canFold:{type:Boolean,default:!1},canCompare:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1},isCurrentPlayer:{type:Boolean,default:!1},isPlayerTurn:{type:Boolean,default:!1},gameId:{type:String,default:""},userId:{type:String,required:!0},bettingRound:{type:Number,default:1}},setup(l){const s=T(!1),o=T(!1),t=T(0),i=T(!1),r=S(()=>{const _=l.hasSeenCards?2:1;return console.log(l.minBet,_),l.minBet*_}),n=S(()=>{const _=l.hasSeenCards?2:1,A=l.minBet*_*5,E=l.hasSeenCards?Math.floor(l.playerGold/2):l.playerGold;return Math.max(A,E)}),h=S(()=>l.bettingRound>3),k=async()=>{if(!(!l.gameId||i.value)){i.value=!0;try{const _={gameId:l.gameId,userId:l.userId};console.log("BetControls: Emit see_cards",_),c.emit("see_cards",_)}catch(_){console.error("çœ‹ç‰Œå¤±è´¥:",_)}}},b=async()=>{if(!(!l.gameId||i.value)){i.value=!0;try{c.emit("call",{gameId:l.gameId,userId:l.userId})}catch(_){console.error("è·Ÿæ³¨å¤±è´¥:",_),i.value=!1}}},G=()=>{console.log(l.gameId,i.value),!(!l.gameId||i.value)&&(s.value=!0)},w=async()=>{if(!l.gameId||i.value)return;const _=l.hasSeenCards?2:1,A=l.minBet*_,E=l.minBet*_*5,M=l.hasSeenCards?Math.floor(l.playerGold/2):l.playerGold,N=Math.max(E,M);if(t.value<A||t.value>N){alert(`åŠ æ³¨é‡‘é¢å¿…é¡»åœ¨ ${A} åˆ° ${N} ä¹‹é—´`);return}i.value=!0;try{c.emit("raise",{gameId:l.gameId,userId:l.userId,amount:t.value}),s.value=!1}catch(q){console.error("åŠ æ³¨å¤±è´¥:",q),i.value=!1}},x=async()=>{if(!(!l.gameId||i.value)){i.value=!0;try{const _={gameId:l.gameId,userId:l.userId};console.log("BetControls: Emit fold",_),c.emit("fold",_)}catch(_){console.error("å¼ƒç‰Œå¤±è´¥:",_),i.value=!1}}},F=()=>{!l.gameId||i.value||(o.value=!0)},L=async _=>{if(!(!l.gameId||i.value)){i.value=!0;try{c.emit("compare",{gameId:l.gameId,userId:l.userId,targetUserId:_}),o.value=!1}catch(A){console.error("æ¯”ç‰Œå¤±è´¥:",A),i.value=!1}}},v=()=>{i.value=!1,console.log("BetControls: Loading state reset")};return te(()=>{c.on("game_state_update",_=>{console.log("BetControls: Received game_state_update",_),v()}),c.on("game_action_result",_=>{console.log("BetControls: Received game_action_result",_),v()}),c.on("error",_=>{console.log("BetControls: Received error",_),v()})}),ae(()=>{c.off("game_state_update"),c.off("game_action_result"),c.off("error")}),{showRaiseDialog:s,showCompareDialog:o,raiseAmount:t,isActionLoading:i,minRaiseAmount:r,maxRaiseAmount:n,canCompareByRound:h,handleSeeCards:k,handleCall:b,handleRaise:G,confirmRaise:w,handleFold:x,handleCompare:F,selectCompareTarget:L}}},ot={class:"bet-controls"},lt={class:"bet-info"},rt={class:"bet-info-item"},it={class:"bet-value"},dt={class:"bet-info-item"},ct={class:"bet-value"},ut={class:"bet-actions"},mt=["disabled","title"],yt=["disabled","title"],vt={class:"btn-text"},ft=["disabled","title"],_t=["disabled","title"],gt=["disabled","title"],ht={class:"dialog-content"},bt={class:"raise-info"},Rt={key:0,class:"raise-notice"},Ct=["min","max"],It={class:"dialog-actions"},kt={class:"dialog-content"},St=["onClick"],Pt={class:"dialog-actions"};function pt(l,s,o,t,i,r){return u(),y("div",ot,[a("div",lt,[a("span",rt,[s[13]||(s[13]=a("span",{class:"bet-label"},"æœ€å°",-1)),a("span",it,"ðŸ’°"+f(t.minRaiseAmount),1)]),a("span",dt,[s[14]||(s[14]=a("span",{class:"bet-label"},"é‡‘å¸",-1)),a("span",ct,"ðŸ’°"+f(o.playerGold),1)])]),a("div",ut,[a("button",{onClick:s[0]||(s[0]=(...n)=>t.handleSeeCards&&t.handleSeeCards(...n)),class:"action-btn see-btn",disabled:!o.canSeeCards||t.isActionLoading||!o.isPlayerTurn,title:o.canSeeCards&&!t.isActionLoading&&o.isPlayerTurn?"æŸ¥çœ‹æ‚¨çš„æ‰‹ç‰Œ":t.isActionLoading?"æ“ä½œå¤„ç†ä¸­...":o.isPlayerTurn?"è¿˜æ— æ³•çœ‹ç‰Œ":"ç­‰å¾…å…¶ä»–çŽ©å®¶æ“ä½œ"}," ðŸ‘ï¸ ",8,mt),a("button",{onClick:s[1]||(s[1]=(...n)=>t.handleCall&&t.handleCall(...n)),class:"action-btn call-btn",disabled:!o.canCall||t.isActionLoading||!o.isPlayerTurn,title:o.canCall&&!t.isActionLoading&&o.isPlayerTurn?`è·Ÿæ³¨ ${t.minRaiseAmount}`:t.isActionLoading?"æ“ä½œå¤„ç†ä¸­...":o.isPlayerTurn?"æ— æ³•è·Ÿæ³¨":"ç­‰å¾…å…¶ä»–çŽ©å®¶æ“ä½œ"},[s[15]||(s[15]=a("span",{class:"btn-icon"},"ðŸ“ž",-1)),a("span",vt,f(t.minRaiseAmount),1)],8,yt),a("button",{onClick:s[2]||(s[2]=(...n)=>t.handleRaise&&t.handleRaise(...n)),class:"action-btn raise-btn",disabled:!o.canRaise||t.isActionLoading||!o.isPlayerTurn,title:o.canRaise&&!t.isActionLoading&&o.isPlayerTurn?"åŠ æ³¨":t.isActionLoading?"æ“ä½œå¤„ç†ä¸­...":o.isPlayerTurn?"æ— æ³•åŠ æ³¨":"ç­‰å¾…å…¶ä»–çŽ©å®¶æ“ä½œ"},[...s[16]||(s[16]=[a("span",{class:"btn-icon"},"â¬†ï¸",-1)])],8,ft),a("button",{onClick:s[3]||(s[3]=(...n)=>t.handleFold&&t.handleFold(...n)),class:"action-btn fold-btn",disabled:!o.canFold||t.isActionLoading||!o.isPlayerTurn,title:o.canFold&&!t.isActionLoading&&o.isPlayerTurn?"å¼ƒç‰Œ":t.isActionLoading?"æ“ä½œå¤„ç†ä¸­...":o.isPlayerTurn?"æ— æ³•å¼ƒç‰Œ":"ç­‰å¾…å…¶ä»–çŽ©å®¶æ“ä½œ"},[...s[17]||(s[17]=[a("span",{class:"btn-icon"},"ðŸ³ï¸",-1)])],8,_t),a("button",{onClick:s[4]||(s[4]=(...n)=>t.handleCompare&&t.handleCompare(...n)),class:"action-btn compare-btn",disabled:!o.canCompare||t.isActionLoading||!o.isPlayerTurn||!t.canCompareByRound,title:o.canCompare&&!t.isActionLoading&&o.isPlayerTurn&&t.canCompareByRound?"æ¯”ç‰Œ":t.isActionLoading?"æ“ä½œå¤„ç†ä¸­...":o.isPlayerTurn?t.canCompareByRound?"æ— æ³•æ¯”ç‰Œ":"å‰ä¸‰è½®ä¸èƒ½æ¯”ç‰Œ":"ç­‰å¾…å…¶ä»–çŽ©å®¶æ“ä½œ"},[...s[18]||(s[18]=[a("span",{class:"btn-icon"},"âš”ï¸",-1)])],8,gt)]),(u(),z($,{to:"body"},[t.showRaiseDialog?(u(),y("div",{key:0,class:"dialog-overlay",onClick:s[9]||(s[9]=n=>t.showRaiseDialog=!1)},[a("div",{class:"dialog",onClick:s[8]||(s[8]=Z(()=>{},["stop"]))},[s[19]||(s[19]=a("h3",null,"åŠ æ³¨",-1)),a("div",ht,[a("div",bt,[a("span",null,"æœ€å°: "+f(t.minRaiseAmount+1),1),a("span",null,"æœ€å¤§: "+f(t.maxRaiseAmount),1)]),o.hasSeenCards?(u(),y("div",Rt," çœ‹ç‰ŒåŽåŠ æ³¨é‡‘é¢å°†ç¿»å€ ")):P("",!0),ue(a("input",{"onUpdate:modelValue":s[5]||(s[5]=n=>t.raiseAmount=n),type:"number",placeholder:"è¾“å…¥åŠ æ³¨é‡‘é¢",class:"dialog-input",min:t.minRaiseAmount,max:t.maxRaiseAmount},null,8,Ct),[[me,t.raiseAmount,void 0,{number:!0}]])]),a("div",It,[a("button",{onClick:s[6]||(s[6]=n=>t.showRaiseDialog=!1),class:"cancel-btn"},"å–æ¶ˆ"),a("button",{onClick:s[7]||(s[7]=(...n)=>t.confirmRaise&&t.confirmRaise(...n)),class:"confirm-btn"},"ç¡®å®š")])])])):P("",!0)])),(u(),z($,{to:"body"},[t.showCompareDialog?(u(),y("div",{key:0,class:"dialog-overlay",onClick:s[12]||(s[12]=n=>t.showCompareDialog=!1)},[a("div",{class:"dialog",onClick:s[11]||(s[11]=Z(()=>{},["stop"]))},[s[20]||(s[20]=a("h3",null,"é€‰æ‹©æ¯”ç‰Œå¯¹æ‰‹",-1)),a("div",kt,[(u(!0),y(j,null,O(o.activePlayers,n=>(u(),y("div",{key:n.userId,onClick:h=>t.selectCompareTarget(n.userId),class:V(["player-option",{disabled:n.isSelf}])},f(n.nickname),11,St))),128))]),a("div",Pt,[a("button",{onClick:s[10]||(s[10]=n=>t.showCompareDialog=!1),class:"cancel-btn"},"å–æ¶ˆ")])])])):P("",!0)]))])}const Gt=J(nt,[["render",pt],["__scopeId","data-v-4672c61b"]]);const wt={name:"SettlementModal",props:{visible:{type:Boolean,default:!1},winner:{type:Object,default:null},playersResults:{type:Array,default:()=>[]},isFinalSettlement:{type:Boolean,default:!1},currentRound:{type:Number,default:0},totalRounds:{type:Number,default:0}},computed:{title(){return this.isFinalSettlement?"æ¸¸æˆç»“æŸ":`ç¬¬ ${this.currentRound} å±€ç»“ç®—`}},methods:{handleOverlayClick(){},handleClose(){},handleContinue(){this.$emit("continue")},handleExit(){this.$emit("exit")}}},Bt={class:"settlement-modal glass-effect"},xt={class:"modal-header"},At={class:"modal-title"},Mt={class:"modal-body"},Tt={key:0,class:"winner-section"},Ft={class:"winner-name"},Lt={class:"winner-reward"},Et={class:"reward-amount"},Vt={key:1,class:"final-results"},Nt={class:"players-results"},Ut={class:"player-rank"},jt={class:"player-info"},Ot={class:"player-name"},qt={class:"modal-footer"};function zt(l,s,o,t,i,r){return o.visible?(u(),y("div",{key:0,class:"settlement-modal-overlay",onClick:s[3]||(s[3]=Z((...n)=>r.handleOverlayClick&&r.handleOverlayClick(...n),["self"]))},[a("div",Bt,[a("div",xt,[a("h2",At,f(r.title),1),a("button",{onClick:s[0]||(s[0]=(...n)=>r.handleClose&&r.handleClose(...n)),class:"close-button"},"Ã—")]),a("div",Mt,[!o.isFinalSettlement&&o.winner?(u(),y("div",Tt,[s[5]||(s[5]=a("div",{class:"winner-icon"},"ðŸ†",-1)),a("div",Ft,f(o.winner.nickname),1),s[6]||(s[6]=a("div",{class:"winner-label"},"æœ¬å±€èŽ·èƒœ",-1)),a("div",Lt,[s[4]||(s[4]=a("span",{class:"reward-label"},"èŽ·å¾—æ”¶ç›Š",-1)),a("span",Et,"ðŸ’° "+f(o.winner.winnings||0),1)])])):o.isFinalSettlement?(u(),y("div",Vt,[s[7]||(s[7]=a("div",{class:"results-title"},"æœ€ç»ˆç»“ç®—",-1)),a("div",Nt,[(u(!0),y(j,null,O(o.playersResults,(n,h)=>(u(),y("div",{key:n.userId,class:V(["player-result-item",{"is-winner":h===0}])},[a("div",Ut,f(h+1),1),a("div",jt,[a("div",Ot,f(n.nickname),1),a("div",{class:V(["player-gold-change",n.goldChange>=0?"positive":"negative"])},f(n.goldChange>=0?"+":"")+f(n.goldChange),3)])],2))),128))])])):P("",!0)]),a("div",qt,[o.isFinalSettlement?(u(),y("button",{key:1,onClick:s[2]||(s[2]=(...n)=>r.handleExit&&r.handleExit(...n)),class:"action-button exit-button"}," é€€å‡ºæˆ¿é—´ ")):(u(),y("button",{key:0,onClick:s[1]||(s[1]=(...n)=>r.handleContinue&&r.handleContinue(...n)),class:"action-button continue-button"}," ç»§ç»­æ¸¸æˆ "))])])])):P("",!0)}const Jt=J(wt,[["render",zt],["__scopeId","data-v-73f80d1e"]]);const Kt={name:"GameRoom",components:{GameBoard:st,BetControls:Gt,SettlementModal:Jt},setup(){const l=ye(),s=ve(),o=he(),t=ge(),i=se(),r=T(null),n=T(null),h=T(!1),k=T(!1),b=T(!1),G=T(!1),w=T({winner:null,playersResults:[],isFinalSettlement:!1,currentRound:0,totalRounds:0}),x=S(()=>n.value?n.value.minBet:0),F=S(()=>{var d;if(!n.value)return 0;const e=(d=n.value.players)==null?void 0:d.find(m=>m.isSelf);return e?e.roomGold:0}),L=S(()=>x.value?[x.value,x.value*2,x.value*5]:[]),v=S(()=>{try{if(!n.value||!n.value.players)return null;const e=n.value.players.find(d=>d&&d.isSelf);return console.log("currentPlayer:",e),e}catch(e){return console.error("currentPlayerè®¡ç®—å±žæ€§å‡ºé”™:",e),null}}),_=S(()=>{try{return v.value?v.value.totalBet:0}catch(e){return console.error("currentPlayerBetè®¡ç®—å±žæ€§å‡ºé”™:",e),0}}),A=S(()=>{try{return v.value?v.value.roomGold:0}catch(e){return console.error("currentPlayerGoldè®¡ç®—å±žæ€§å‡ºé”™:",e),0}}),E=S(()=>{try{return!n.value||!n.value.players?[]:n.value.players.filter(d=>d&&d.status==="playing")}catch(e){return console.error("activePlayersè®¡ç®—å±žæ€§å‡ºé”™:",e),[]}}),M=S(()=>{try{const e=!!v.value;return console.log("isCurrentPlayer:",e),e}catch(e){return console.error("isCurrentPlayerè®¡ç®—å±žæ€§å‡ºé”™:",e),!1}}),N=S(()=>{var e,d;try{return!n.value||!v.value||n.value.status!=="betting"||v.value.status!=="playing"?!1:((e=n.value.currentPlayerId)==null?void 0:e.toString())===((d=v.value.userId)==null?void 0:d.toString())}catch(m){return console.error("isPlayerTurnè®¡ç®—å±žæ€§å‡ºé”™:",m),!1}}),q=S(()=>{var e;try{return v.value&&!v.value.hasSeenCards&&((e=n.value)==null?void 0:e.status)==="betting"&&M.value}catch(d){return console.error("canSeeCardsè®¡ç®—å±žæ€§å‡ºé”™:",d),!1}}),Q=S(()=>{var e;try{return v.value&&v.value.status==="playing"&&((e=n.value)==null?void 0:e.status)==="betting"&&M.value}catch(d){return console.error("canCallè®¡ç®—å±žæ€§å‡ºé”™:",d),!1}}),W=S(()=>{var e;try{return v.value&&v.value.status==="playing"&&((e=n.value)==null?void 0:e.status)==="betting"&&M.value}catch(d){return console.error("canRaiseè®¡ç®—å±žæ€§å‡ºé”™:",d),!1}}),X=S(()=>{var e;try{return v.value&&v.value.status==="playing"&&((e=n.value)==null?void 0:e.status)==="betting"&&M.value}catch(d){return console.error("canFoldè®¡ç®—å±žæ€§å‡ºé”™:",d),!1}}),Y=S(()=>{var e,d;try{return v.value&&v.value.status==="playing"&&E.value.length>1&&((e=n.value)==null?void 0:e.status)==="betting"&&((d=n.value)==null?void 0:d.bettingRound)>3&&M.value}catch(m){return console.error("canCompareè®¡ç®—å±žæ€§å‡ºé”™:",m),!1}}),H=S(()=>{var m,g,R,C,p;return!r.value||!r.value.players||r.value.players.length<2||!r.value.players.every(B=>B.isReady)?!1:r.value.creator&&(((m=r.value.creator._id)==null?void 0:m.toString())===((R=(g=i==null?void 0:i.user)==null?void 0:g.id)==null?void 0:R.toString())||r.value.creator.toString()===((p=(C=i==null?void 0:i.user)==null?void 0:C.id)==null?void 0:p.toString()))}),I=()=>{var e;r.value&&c.emit("player_ready",{roomId:r.value.roomId,userId:(e=i==null?void 0:i.user)==null?void 0:e.id,isReady:!h.value})},ne=(e,d)=>new Promise((m,g)=>{const R=`${e}_success`,C="error",p=U=>{c.off(R,p),c.off(C,B),m(U)},B=U=>{c.off(R,p),c.off(C,B),g(new Error(U.message||"è¯·æ±‚å¤±è´¥"))};c.on(R,p),c.on(C,B),c.emit(e,d)}),oe=()=>{var e;r.value&&c.emit("start_game",{roomId:r.value.roomId,userId:(e=i==null?void 0:i.user)==null?void 0:e.id})},D=async()=>{var e;if(!(!r.value||b.value)){b.value=!0;try{const d={roomId:r.value.roomId,userId:(e=i==null?void 0:i.user)==null?void 0:e.id};console.log("GameRoom: Emit leave_room",d),await ne("leave_room",d),c.clearCurrentRoom(),s.push("/")}catch(d){console.error("é€€å‡ºæˆ¿é—´å¤±è´¥:",d.message),alert("é€€å‡ºæˆ¿é—´å¤±è´¥: "+d.message)}finally{b.value=!1}}},le=()=>{G.value=!1,w.value={winner:null,playersResults:[],isFinalSettlement:!1,currentRound:0,totalRounds:0}},re=()=>{G.value=!1,w.value={winner:null,playersResults:[],isFinalSettlement:!1,currentRound:0,totalRounds:0},D()},ie=()=>{c.on("test_response",e=>{console.log("GameRoom: Received test_response",e)}),c.on("test_event",e=>{console.log("GameRoom: Received test_event",e);const d={response:"æµ‹è¯•å“åº”",originalData:e};console.log("GameRoom: Emit test_response",d),c.emit("test_response",d)}),c.on("room_updated",e=>{var m,g;if(console.log("GameRoom: Received room_updated",e),r.value=e,e.status==="playing"&&!k.value){k.value=!0;const R={roomId:l.params.roomId,userId:(m=i==null?void 0:i.user)==null?void 0:m.id};console.log("GameRoom: Emit get_game_data",R),c.emit("get_game_data",R)}const d=(g=e.players)==null?void 0:g.find(R=>{var C;return R.userId===((C=i==null?void 0:i.user)==null?void 0:C.id)});h.value=d?d.isReady:!1}),c.on("player_left",e=>{console.log("GameRoom: Received player_left",e),e.nickname}),c.on("player_folded",e=>{console.log("GameRoom: Received player_folded",e),e.message}),c.on("player_offline_folded",e=>{console.log("GameRoom: Received player_offline_folded",e),e.message}),c.on("game_started",e=>{if(console.log("GameRoom: Received game_started",e),console.log("Before assignment:",n.value),console.log("Game data ID:",(e==null?void 0:e._id)||(e==null?void 0:e.id)),k.value=!0,n.value=e,_e(n),r.value&&e.players){const d=r.value.players.map(m=>{const g=e.players.find(R=>R.userId.toString()===m.userId.toString());return{...m,roomGold:g?g.roomGold:m.roomGold}});r.value={...r.value,players:d}}}),c.on("game_state_update",e=>{var m,g,R;console.log("GameRoom: Received game_state_update",e),console.log("Game state update ID:",(e==null?void 0:e._id)||(e==null?void 0:e.id)),console.log("Game state update currentPlayerId:",e==null?void 0:e.currentPlayerId),console.log("Game state update players:",(m=e==null?void 0:e.players)==null?void 0:m.map(C=>({userId:C.userId,roomGold:C.roomGold,isSelf:C.isSelf})));const d={...e,id:e._id||e.id||((g=n.value)==null?void 0:g._id)||((R=n.value)==null?void 0:R.id)};if(n.value=d,r.value&&d.players){const C=r.value.players.map(p=>{const B=d.players.find(U=>U.userId.toString()===p.userId.toString());return{...p,roomGold:B?B.roomGold:p.roomGold}});r.value={...r.value,players:C}}t&&typeof t.setCurrentGame=="function"&&t.setCurrentGame(d)}),c.on("game_action_result",e=>{var m,g,R;console.log("GameRoom: Received game_action_result",e),console.log("Game action result ID:",(e==null?void 0:e._id)||(e==null?void 0:e.id)),console.log("Game action result currentPlayerId:",e==null?void 0:e.currentPlayerId),console.log("Game action result players:",(m=e==null?void 0:e.players)==null?void 0:m.map(C=>({userId:C.userId,roomGold:C.roomGold,isSelf:C.isSelf})));const d={...e,id:e._id||e.id||((g=n.value)==null?void 0:g._id)||((R=n.value)==null?void 0:R.id)};if(n.value=d,r.value&&d.players){const C=r.value.players.map(p=>{const B=d.players.find(U=>U.userId.toString()===p.userId.toString());return{...p,roomGold:B?B.roomGold:p.roomGold}});r.value={...r.value,players:C}}t&&typeof t.setCurrentGame=="function"&&t.setCurrentGame(d)}),c.on("round_ended",e=>{console.log("GameRoom: Received round_ended",e),k.value=!1,n.value=null,t&&typeof t.clearCurrentGame=="function"&&t.clearCurrentGame(),w.value={winner:e.winner,playersResults:[],isFinalSettlement:!1,currentRound:e.currentRound,totalRounds:e.totalRounds},G.value=!0}),c.on("game_ended",e=>{console.log("GameRoom: Received game_ended",e),k.value=!1,n.value=null,t&&typeof t.clearCurrentGame=="function"&&t.clearCurrentGame(),w.value={winner:e.winner,playersResults:e.playersResults||[],isFinalSettlement:!0,currentRound:e.totalRounds,totalRounds:e.totalRounds},G.value=!0}),c.on("error",e=>{console.log("GameRoom: Received error",e),alert(e.message||"å‘ç”ŸæœªçŸ¥é”™è¯¯")}),c.on("room_disbanded",e=>{console.log("GameRoom: Received room_disbanded",e),alert(e.message),s.push("/")}),c.on("leave_room_success",()=>{console.log("GameRoom: Received leave_room_success"),s.push("/")})},de=()=>new Promise((e,d)=>{if(c.getStatus().connected){e();return}let m=0;const g=100,R=setInterval(()=>{m++,c.getStatus().connected?(clearInterval(R),e()):m>=g&&(clearInterval(R),d(new Error("Socketè¿žæŽ¥è¶…æ—¶")))},100)}),ce=()=>{c.off("room_updated"),c.off("player_left"),c.off("game_started"),c.off("game_state_update"),c.off("game_action_result"),c.off("game_ended"),c.off("error"),c.off("room_disbanded"),c.off("leave_room_success")};return te(async()=>{var e,d;try{const m=l.params.roomId,g=await o.fetchRoomDetail(m);r.value=g,g.players&&g.players.some(p=>{var B;return p.userId===((B=i==null?void 0:i.user)==null?void 0:B.id)})||(await o.joinRoom(m),r.value=o.currentRoom);const C="http://localhost:3000";c.connect(C),ie(),await de(),c.setCurrentRoom(m,(e=i==null?void 0:i.user)==null?void 0:e.id),c.emit("user_join",{userId:(d=i==null?void 0:i.user)==null?void 0:d.id,roomId:m})}catch(m){console.error("åŠ å…¥æˆ¿é—´å¤±è´¥:",m);let g="åŠ å…¥æˆ¿é—´å¤±è´¥";m.message&&m.message.includes("Socketè¿žæŽ¥è¶…æ—¶")?g="Socketè¿žæŽ¥è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•":m.message&&(g=m.message),alert(g),s.push("/")}}),ae(()=>{var e;ce(),r.value&&c.emit("leave_room",{roomId:r.value.roomId,userId:(e=i==null?void 0:i.user)==null?void 0:e.id}),c.clearCurrentRoom(),c.disconnect()}),{room:r,currentGame:n,isReady:h,gameStarted:k,minBet:x,maxBet:F,quickRaiseOptions:L,currentPlayer:v,isCurrentPlayer:M,currentPlayerBet:_,currentPlayerGold:A,canSeeCards:q,canCall:Q,canRaise:W,canFold:X,canCompare:Y,canStartGame:H,activePlayers:E,leavingRoom:b,toggleReady:I,startGame:oe,leaveRoom:D,isPlayerTurn:N,authStore:i,settlementModalVisible:G,settlementData:w,handleSettlementContinue:le,handleSettlementExit:re}}},Qt={class:"game-room-container"},Wt={class:"navbar glass-effect"},Xt={class:"nav-left"},Yt=["disabled"],Ht={key:0},Zt={key:1},Dt={class:"nav-center"},$t={class:"title"},ea={class:"nav-right"},ta={class:"room-info"},aa={class:"room-id"},sa={key:0,class:"room-info-section glass-effect"},na={class:"room-details"},oa={class:"detail-item"},la={class:"value"},ra={class:"detail-item"},ia={class:"value"},da={class:"detail-item"},ca={class:"value"},ua={class:"detail-item"},ma={class:"value"},ya={key:1,class:"players-section glass-effect"},va={class:"section-title"},fa={class:"players-grid"},_a={class:"player-name"},ga={class:"player-status"},ha={key:0,class:"ready-tag"},ba={key:1,class:"not-ready-tag"},Ra={class:"player-gold"},Ca={key:2,class:"ready-section"},Ia=["disabled"],ka=["disabled"],Sa={key:3,class:"game-section"};function Pa(l,s,o,t,i,r){var b,G,w,x,F,L,v,_,A,E,M,N,q,Q,W,X,Y,H;const n=K("GameBoard"),h=K("BetControls"),k=K("SettlementModal");return u(),y("div",Qt,[a("nav",Wt,[a("div",Xt,[a("button",{onClick:s[0]||(s[0]=(...I)=>t.leaveRoom&&t.leaveRoom(...I)),class:"back-button",disabled:t.leavingRoom},[t.leavingRoom?(u(),y("span",Ht,"é€€å‡ºä¸­...")):(u(),y("span",Zt,"â† é€€å‡ºæˆ¿é—´"))],8,Yt)]),a("div",Dt,[a("h1",$t,f(((b=t.room)==null?void 0:b.name)||"æ¸¸æˆæˆ¿é—´"),1)]),a("div",ea,[a("div",ta,[a("span",aa,"æˆ¿é—´å·: "+f((G=t.room)==null?void 0:G.roomId),1)])])]),t.gameStarted?P("",!0):(u(),y("div",sa,[a("div",na,[a("div",oa,[s[4]||(s[4]=a("span",{class:"label"},"å…¥åœºé‡‘å¸:",-1)),a("span",la,f((w=t.room)==null?void 0:w.entryGold),1)]),a("div",ra,[s[5]||(s[5]=a("span",{class:"label"},"å•æ³¨é‡‘é¢:",-1)),a("span",ia,f((x=t.room)==null?void 0:x.betAmount),1)]),a("div",da,[s[6]||(s[6]=a("span",{class:"label"},"æ€»å±€æ•°:",-1)),a("span",ca,f((F=t.room)==null?void 0:F.totalRounds),1)]),a("div",ua,[s[7]||(s[7]=a("span",{class:"label"},"å½“å‰å±€æ•°:",-1)),a("span",ma,f((L=t.room)==null?void 0:L.currentRound)+"/"+f((v=t.room)==null?void 0:v.totalRounds),1)])])])),t.gameStarted?P("",!0):(u(),y("div",ya,[a("h2",va,"æˆ¿é—´çŽ©å®¶ ("+f(((A=(_=t.room)==null?void 0:_.players)==null?void 0:A.length)||0)+"/5)",1),a("div",fa,[(u(!0),y(j,null,O((E=t.room)==null?void 0:E.players,I=>(u(),y("div",{key:I.id,class:V(["player-card",{"is-self":I.isSelf,"is-ready":I.isReady}])},[s[8]||(s[8]=a("div",{class:"player-avatar"},[a("div",{class:"avatar-placeholder"},"ðŸ‘¤")],-1)),a("div",_a,f(I.nickname||I.phoneNumber),1),a("div",ga,[I.isReady?(u(),y("span",ha,"å·²å‡†å¤‡")):(u(),y("span",ba,"æœªå‡†å¤‡"))]),a("div",Ra,"ðŸ’° "+f(I.roomGold),1)],2))),128)),(u(!0),y(j,null,O(5-(((N=(M=t.room)==null?void 0:M.players)==null?void 0:N.length)||0),I=>(u(),y("div",{key:"empty-"+I,class:"player-card empty-slot"},[...s[9]||(s[9]=[a("div",{class:"player-avatar"},[a("div",{class:"avatar-placeholder"},"âž•")],-1),a("div",{class:"player-name"},"ç©ºä½",-1),a("div",{class:"player-status"},"ç­‰å¾…åŠ å…¥",-1)])]))),128))])])),t.gameStarted?P("",!0):(u(),y("div",Ca,[a("button",{onClick:s[1]||(s[1]=(...I)=>t.toggleReady&&t.toggleReady(...I)),class:V(["ready-button",{ready:t.isReady}]),disabled:!t.room},f(t.isReady?"å–æ¶ˆå‡†å¤‡":"å‡†å¤‡"),11,Ia),a("button",{onClick:s[2]||(s[2]=(...I)=>t.startGame&&t.startGame(...I)),class:"start-button",disabled:!t.canStartGame}," å¼€å§‹æ¸¸æˆ ",8,ka)])),t.gameStarted?(u(),y("div",Sa,[fe(n,{game:t.currentGame,room:t.room,class:"game-board-section"},null,8,["game","room"]),t.isCurrentPlayer&&t.currentGame&&((Q=(q=t.authStore)==null?void 0:q.user)!=null&&Q.id)?(u(),z(h,{key:0,"min-bet":t.minBet,"player-gold":t.currentPlayerGold,"active-players":t.activePlayers,"can-see-cards":t.canSeeCards,"can-call":t.canCall,"can-raise":t.canRaise,"can-fold":t.canFold,"can-compare":t.canCompare,"is-current-player":t.isCurrentPlayer,"is-player-turn":t.isPlayerTurn,"game-id":t.currentGame._id||t.currentGame.id,"user-id":(X=(W=t.authStore)==null?void 0:W.user)==null?void 0:X.id,"has-seen-cards":(Y=t.currentPlayer)==null?void 0:Y.hasSeenCards,"betting-round":((H=t.currentGame)==null?void 0:H.bettingRound)||1,class:"bet-controls-section"},null,8,["min-bet","player-gold","active-players","can-see-cards","can-call","can-raise","can-fold","can-compare","is-current-player","is-player-turn","game-id","user-id","has-seen-cards","betting-round"])):P("",!0)])):P("",!0),t.settlementModalVisible?(u(),z(k,{key:4,modelValue:t.settlementModalVisible,"onUpdate:modelValue":s[3]||(s[3]=I=>t.settlementModalVisible=I),winner:t.settlementData.winner,"players-results":t.settlementData.playersResults,"is-final-settlement":t.settlementData.isFinalSettlement,"current-round":t.settlementData.currentRound,"total-rounds":t.settlementData.totalRounds,onContinue:t.handleSettlementContinue,onExit:t.handleSettlementExit},null,8,["modelValue","winner","players-results","is-final-settlement","current-round","total-rounds","onContinue","onExit"])):P("",!0)])}const xa=J(Kt,[["render",Pa],["__scopeId","data-v-265b81ef"]]);export{xa as default};
